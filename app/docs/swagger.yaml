consumes:
- application/json
definitions:
  commonhandlers.JWKSResponse:
    properties:
      keys:
        items:
          additionalProperties: {}
          type: object
        type: array
    type: object
  commonhandlers.VersionResponse:
    properties:
      build_time:
        example: "2024-01-28T10:00:00Z"
        type: string
      service:
        example: pint-server
        type: string
      version:
        example: 1.0.0
        type: string
    type: object
  ebl.EblEnvelope:
    properties:
      envelopeManifestSignedContent:
        description: |-
          EnvelopeManifestSignedContent: JWS compact serialization of the EnvelopeManifest
          (signed by the sending platform).

          The EnvelopeManifest payload is used by the receiver to verify that the transport
          document and the transfer chain have not been tampered with and to provide
          details of any supporting documents transferred via PINT.
        type: string
      envelopeTransferChain:
        description: |-
          EnvelopeTransferChain: Ordered list of JWS strings representing the complete
          transfer chain.

          Each EnvelopeTransferChainEntry represents a batch of transactions
          that happened on a single platform and is is signed by the sending platform.

          The full chain is required by the receiver to verify the complete history and detect tampering.
        items:
          type: string
        type: array
      transportDocument:
        description: 'TransportDocument: The transport document (Bill of Lading) as
          a JSON object.'
        type: object
    type: object
  pint.DetailedError:
    properties:
      errorCode:
        allOf:
        - $ref: '#/definitions/pint.ErrorCode'
        description: A standard error code see https://developer.dcsa.org/standard-error-codes
      errorCodeMessage:
        type: string
      errorCodeText:
        type: string
      jsonPath:
        type: string
      property:
        type: string
      value:
        type: string
    type: object
  pint.EnvelopeTransferStartedResponse:
    properties:
      envelopeReference:
        description: |-
          EnvelopeReference is the receiver-generated opaque identifier for this envelope transfer.
          Used in subsequent API calls (PUT additional-documents, PUT finish-transfer).
          Max length: 100 characters
        type: string
      lastEnvelopeTransferChainEntrySignedContentChecksum:
        description: |-
          LastEnvelopeTransferChainEntrySignedContentChecksum is the SHA-256 checksum of the last
          transfer chain entry received.
          Length: exactly 64 hex characters
        type: string
      missingAdditionalDocumentChecksums:
        description: |-
          MissingAdditionalDocumentChecksums lists the checksums of additional documents that
          the receiving platform expects to receive before accepting the envelope transfer.
          Empty array if no additional documents are required.
        items:
          type: string
        type: array
      transportDocumentChecksum:
        description: |-
          TransportDocumentChecksum is the SHA-256 checksum of the transport document (eBL).
          Computed on the canonical form of the JSON.
          Length: exactly 64 hex characters
        type: string
    type: object
  pint.ErrorCode:
    enum:
    - 7001
    - 7002
    - 7003
    - 7004
    - 7005
    - 7006
    - 7007
    - 7008
    - 7009
    - 7010
    - 8001
    - 8002
    type: integer
    x-enum-comments:
      ErrCodeInsufficientTrust: Trust level below minimum required
      ErrCodeMalformedJSON: JSON parsing or encoding failed
    x-enum-descriptions:
    - ""
    - ""
    - ""
    - ""
    - ""
    - JSON parsing or encoding failed
    - ""
    - ""
    - ""
    - ""
    - ""
    - Trust level below minimum required
    x-enum-varnames:
    - ErrCodeBadSignature
    - ErrCodeBadCertificate
    - ErrCodeBadChecksum
    - ErrCodeInvalidEnvelope
    - ErrCodeInternalError
    - ErrCodeMalformedJSON
    - ErrCodeKeyError
    - ErrCodeRegistryError
    - ErrCodeRateLimitExceeded
    - ErrCodeRequestTooLarge
    - ErrCodeUnknownParty
    - ErrCodeInsufficientTrust
  pint.ErrorResponse:
    properties:
      errorDateTime:
        description: The DateTime corresponding to the error occurring
        type: string
      errors:
        description: An array of errors providing more detail about the root cause
        items:
          $ref: '#/definitions/pint.DetailedError'
        type: array
      httpMethod:
        description: The HTTP method used to make the request e.g. GET, POST, etc
        type: string
      providerCorrelationReference:
        description: A unique identifier to the HTTP request within the scope of the
          API provider
        type: string
      requestUri:
        description: The URI that was requested
        type: string
      statusCode:
        description: The HTTP status code returned
        type: integer
      statusCodeMessage:
        description: A long description corresponding to the HTTP status code with
          additional information
        type: string
      statusCodeText:
        description: A standard short description corresponding to the HTTP status
          code
        type: string
    type: object
info:
  contact: {}
  description: |
    pint-demo is an implemenation of the DCSA v3 PINT API for receiving eBL envelope transfers

    ## Common Error Responses
    All endpoints may return:
    - `413` Request body exceeds size limit
    - `429` Rate limit exceeded
    - `500` Internal server error

    Individual endpoints document their specific business logic errors.

    ## Request Limits
    All endpoints are protected by:
    - **Rate limiting**: Configurable requests per second (see env vars) - default 100 rps (set to 0 to disable)
    - **Request size limits**: Configurable (see env vars) - default 1MB

    Check the X-Max-Request-Body response header for the configured limit on signals payload.

    The rate limit is set globaly and prevents abuse of the service.
    In production there will be additional protections in place such as per-IP rate limiting provided by the load balancer/reverse proxy.

    ## Authentication & Authorization

    The pint-demo PINT APIs do not require credentials to be sent with the request.
    Participating platforms are authenticated via JWS signatures -
    requests must be signed with a key registered in the platform registry. Unrecognized keys are rejected.

    In a real production system, OAuth 2.0 service accounts would provide additional authentication and authorization capabilities,
    e.g where external clients need to initiate a transfer on behalf of a user.
  license:
    name: MIT
  title: DCSA API
paths:
  /.well-known/jwks.json:
    get:
      description: |-
        Returns the JWK set for the platform
        Use this endpoint to retrieve the public keys used to verify signatures from this platform.

        The JWK set in the response conforms to the [JWK specification](https://datatracker.ietf.org/doc/html/rfc7517).

        Note: this service supports Ed25519 and RSA public keys so you should expect to see either of these key types in the JWK set.
      responses:
        "200":
          description: JWK set
          schema:
            $ref: '#/definitions/commonhandlers.JWKSResponse'
      summary: Get JWK set
      tags:
      - Common
  /health/live:
    get:
      description: Check if the signalsd http service is alive and responding.
      produces:
      - text/plain
      responses:
        "200":
          description: OK
          schema:
            type: string
      summary: Health (liveness) Check
      tags:
      - Common
  /ready:
    get:
      description: Checks if the service is ready to accept traffic (includes database
        connectivity)
      produces:
      - application/json
      responses:
        "200":
          description: status ready
          schema:
            additionalProperties:
              type: string
            type: object
        "503":
          description: status not ready
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Readiness Check
      tags:
      - Common
  /v3/envelopes:
    post:
      description: |-
        Use this endpoint to initiate an eBL envelope transfer on the server.

        The sending platform must supply a request containing the transport document (eBL),
        a signed envelope manifest, and the complete transfer chain.

        The receiving platform will check that the signatures are verified, checksums validated,
        and the transfer chain integrity.

        The response includes an `envelopeReference` that must be used in subsequent API calls
        to upload additional documents and finish the transfer.
      parameters:
      - description: eBL envelope containing transport document, signed manifest,
          and transfer chain
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/ebl.EblEnvelope'
      responses:
        "200":
          description: Transfer accepted or duplicate detected
          schema:
            $ref: '#/definitions/pint.EnvelopeTransferStartedResponse'
        "201":
          description: Transfer started, additional documents required
          schema:
            $ref: '#/definitions/pint.EnvelopeTransferStartedResponse'
        "400":
          description: Malformed request
          schema:
            $ref: '#/definitions/pint.ErrorResponse'
        "409":
          description: Disputed envelope
          schema:
            $ref: '#/definitions/pint.ErrorResponse'
        "422":
          description: Signature or validation failed
          schema:
            $ref: '#/definitions/pint.ErrorResponse'
      summary: Start envelope transfer
      tags:
      - PINT
  /version:
    get:
      description: Returns the version and build information for the service
      produces:
      - application/json
      responses:
        "200":
          description: Version information
          schema:
            $ref: '#/definitions/commonhandlers.VersionResponse'
      summary: Get version information
      tags:
      - Common
produces:
- application/json
swagger: "2.0"
tags:
- description: PINT API endpoints
  name: PINT
- description: Server API endpoints (jwks, health, readiness, version, etc.)
  name: Common
