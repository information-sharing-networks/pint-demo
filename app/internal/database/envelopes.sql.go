// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: envelopes.sql

package database

import (
	"context"

	"github.com/google/uuid"
)

const CreateEnvelope = `-- name: CreateEnvelope :one
INSERT INTO envelopes (
    id,
    created_at,
    updated_at,
    transport_document_checksum,
    sent_by_platform_code,
    last_transfer_chain_entry_checksum,
    envelope_manifest_signed_content,
    last_transfer_chain_entry_signed_content,
    response_code,
    response_reason,
    trust_level
) VALUES (
    gen_random_uuid(),
    NOW(),
    NOW(),
    $1,
    $2,
    $3,
    $4,
    $5,
    $6,
    $7,
    $8
) RETURNING id, created_at, updated_at, transport_document_checksum, sent_by_platform_code, last_transfer_chain_entry_checksum, envelope_manifest_signed_content, last_transfer_chain_entry_signed_content, response_code, response_reason, trust_level
`

type CreateEnvelopeParams struct {
	TransportDocumentChecksum           string  `json:"transport_document_checksum"`
	SentByPlatformCode                  string  `json:"sent_by_platform_code"`
	LastTransferChainEntryChecksum      string  `json:"last_transfer_chain_entry_checksum"`
	EnvelopeManifestSignedContent       string  `json:"envelope_manifest_signed_content"`
	LastTransferChainEntrySignedContent string  `json:"last_transfer_chain_entry_signed_content"`
	ResponseCode                        *string `json:"response_code"`
	ResponseReason                      *string `json:"response_reason"`
	TrustLevel                          int32   `json:"trust_level"`
}

// Create a new envelope record for a transfer session
func (q *Queries) CreateEnvelope(ctx context.Context, arg CreateEnvelopeParams) (Envelope, error) {
	row := q.db.QueryRow(ctx, CreateEnvelope,
		arg.TransportDocumentChecksum,
		arg.SentByPlatformCode,
		arg.LastTransferChainEntryChecksum,
		arg.EnvelopeManifestSignedContent,
		arg.LastTransferChainEntrySignedContent,
		arg.ResponseCode,
		arg.ResponseReason,
		arg.TrustLevel,
	)
	var i Envelope
	err := row.Scan(
		&i.ID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.TransportDocumentChecksum,
		&i.SentByPlatformCode,
		&i.LastTransferChainEntryChecksum,
		&i.EnvelopeManifestSignedContent,
		&i.LastTransferChainEntrySignedContent,
		&i.ResponseCode,
		&i.ResponseReason,
		&i.TrustLevel,
	)
	return i, err
}

const ExistsEnvelopeByLastChainEntryChecksum = `-- name: ExistsEnvelopeByLastChainEntryChecksum :one
SELECT EXISTS(
    SELECT 1 FROM envelopes 
    WHERE last_transfer_chain_entry_checksum = $1
)
`

// Check if an transfer with this last_transfer_chain_entry_checksum already exists
func (q *Queries) ExistsEnvelopeByLastChainEntryChecksum(ctx context.Context, lastTransferChainEntryChecksum string) (bool, error) {
	row := q.db.QueryRow(ctx, ExistsEnvelopeByLastChainEntryChecksum, lastTransferChainEntryChecksum)
	var exists bool
	err := row.Scan(&exists)
	return exists, err
}

const GetEnvelopeByLastChainEntryChecksum = `-- name: GetEnvelopeByLastChainEntryChecksum :one
SELECT id, created_at, updated_at, transport_document_checksum, sent_by_platform_code, last_transfer_chain_entry_checksum, envelope_manifest_signed_content, last_transfer_chain_entry_signed_content, response_code, response_reason, trust_level FROM envelopes 
WHERE last_transfer_chain_entry_checksum = $1
`

func (q *Queries) GetEnvelopeByLastChainEntryChecksum(ctx context.Context, lastTransferChainEntryChecksum string) (Envelope, error) {
	row := q.db.QueryRow(ctx, GetEnvelopeByLastChainEntryChecksum, lastTransferChainEntryChecksum)
	var i Envelope
	err := row.Scan(
		&i.ID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.TransportDocumentChecksum,
		&i.SentByPlatformCode,
		&i.LastTransferChainEntryChecksum,
		&i.EnvelopeManifestSignedContent,
		&i.LastTransferChainEntrySignedContent,
		&i.ResponseCode,
		&i.ResponseReason,
		&i.TrustLevel,
	)
	return i, err
}

const GetEnvelopeByReference = `-- name: GetEnvelopeByReference :one
SELECT id, created_at, updated_at, transport_document_checksum, sent_by_platform_code, last_transfer_chain_entry_checksum, envelope_manifest_signed_content, last_transfer_chain_entry_signed_content, response_code, response_reason, trust_level FROM envelopes 
WHERE id = $1
`

// Get envelope by envelope reference (id)
func (q *Queries) GetEnvelopeByReference(ctx context.Context, id uuid.UUID) (Envelope, error) {
	row := q.db.QueryRow(ctx, GetEnvelopeByReference, id)
	var i Envelope
	err := row.Scan(
		&i.ID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.TransportDocumentChecksum,
		&i.SentByPlatformCode,
		&i.LastTransferChainEntryChecksum,
		&i.EnvelopeManifestSignedContent,
		&i.LastTransferChainEntrySignedContent,
		&i.ResponseCode,
		&i.ResponseReason,
		&i.TrustLevel,
	)
	return i, err
}

const UpdateEnvelopeResponse = `-- name: UpdateEnvelopeResponse :exec
UPDATE envelopes
SET
    response_code = $2,
    response_reason = $3,
    updated_at = NOW()
WHERE id = $1
`

type UpdateEnvelopeResponseParams struct {
	ID             uuid.UUID `json:"id"`
	ResponseCode   *string   `json:"response_code"`
	ResponseReason *string   `json:"response_reason"`
}

// Update envelope response code and reason
func (q *Queries) UpdateEnvelopeResponse(ctx context.Context, arg UpdateEnvelopeResponseParams) error {
	_, err := q.db.Exec(ctx, UpdateEnvelopeResponse, arg.ID, arg.ResponseCode, arg.ResponseReason)
	return err
}
